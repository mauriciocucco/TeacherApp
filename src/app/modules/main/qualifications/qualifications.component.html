<div id="container">
	<app-filters></app-filters>

	<app-alphabet 
		*ngIf="students() && students()!.length > 0 && !spinnerProgressOn()"
		[ngClass]="{'disappear': selectedStudent()}"
		>
	</app-alphabet>

	<!-- Para que se muestre el div, el tasksExamsAndStudents$ tiene que emitir algo que exista y tienen que haber alumnxs -->
	<div
		id="students-cards-container"
		*ngIf="
			(tasksExamsAndStudents$ | async) &&
				students() &&
				students()!.length > 0 &&
				!spinnerProgressOn();
			else selectCourseWarning"
			[ngClass]="{'mobile-margin-top': selectedStudent()}"
			>
		<ng-container *ngFor="let student of students(); trackBy: trackItems">
			<mat-card [ngClass]="{'disappear': !student.show}" id="{{ student.lastname.charAt(0).toUpperCase()}}">
					<mat-card-header
						><h2 class="student-header">
							{{ student.name }} {{ student.lastname }}
						</h2></mat-card-header
					>
					<mat-card-content>
						<mat-tab-group
							#tabChildren
							[selectedIndex]="selectedTab()"
							id="qualifications-tab-group">
							<mat-tab label="Tareas">
								<div
									class="cards-wrapper"
									*ngIf="
										taskMatchSomeFilter();
										else noMatchedTasks
									">
									<ng-container *ngFor="let task of tasks(); trackBy: trackItems">
										<app-work-card [work]="task" [student]="student"></app-work-card>
									</ng-container>
								</div>
								<ng-template #noMatchedTasks>
									<app-warning [info]="'No se encontraron tareas'"></app-warning>
								</ng-template>
							</mat-tab>

							<mat-tab label="Exámenes">
								<div
									class="cards-wrapper"
									*ngIf="
										examMatchSomeFilter();
										else noMatchedExams
									">
									<ng-container *ngFor="let exam of exams(); trackBy: trackItems">
										<app-work-card [work]="exam" [student]="student" [workType]="WorkEnum.EXAM"></app-work-card>
									</ng-container>
								</div>
								<ng-template #noMatchedExams>
									<app-warning [info]="'No se encontraron exámenes'"></app-warning>
								</ng-template>
							</mat-tab>
						</mat-tab-group>
					</mat-card-content>
			</mat-card>
		</ng-container>
	</div>

	<div *ngIf="spinnerProgressOn()" class="spinner-wrapper">
		<mat-spinner></mat-spinner>
	</div>

	<ng-template #selectCourseWarning>
		<ng-container
			[ngTemplateOutlet]="
				students()?.length === 0? noStudents : studentsFound
			"></ng-container>

		<ng-template #studentsFound>
			<div *ngIf="!spinnerProgressOn()" class="warning-container" appViewListener>
				<app-warning [info]="'Por favor, seleccione un curso'"></app-warning>
			</div>
		</ng-template>

		<ng-template #noStudents>
			<div class="warning-container" *ngIf="!spinnerProgressOn()">
				<app-warning [info]="'No existen alumnxs cargados para este curso'"></app-warning>
			</div>
		</ng-template>
	</ng-template>

	<!-- TODO: PROBAR CON NG CONTENT Y CONTENT PROJECTION -->
	<button
		id="createButton"
		title="Crear una nueva tarea o exámen"
		mat-fab
		color="accent"
		aria-label="Crear una nueva tarea o exámen"
		*ngIf="students() ? students()!.length > 0 : false"
		[matMenuTriggerFor]="menu"
		>
		<mat-icon>add</mat-icon>
	</button>

	<mat-menu #menu="matMenu">
		<button mat-menu-item (click)="openCreateDialog()">
			<div class="menu-option-wrapper">
				<mat-icon aria-hidden="false" aria-label="Agregar nueva tarea / examen" fontIcon="note_add"></mat-icon>
				<span>Crear una tarea / examen</span>
			</div>
		</button>
		<button mat-menu-item (click)="openMultipleMarkingSetterDialog()">
			<div class="menu-option-wrapper">
				<mat-icon aria-hidden="false" aria-label="Asignar múltiples calificaciones" fontIcon="grading"></mat-icon>
				<span>Asignar múltiples calificaciones</span>
			</div>
		</button>
	</mat-menu>

	<app-scroll *ngIf="showScroll$ | async" (scrollToTop)="onScrollToTop()"></app-scroll>
</div>

