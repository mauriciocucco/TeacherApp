<div id="container" [ngClass]="{'clean-height': students().length}" *ngIf="(filteredData$ | async)">
	<app-filters></app-filters>

	<app-alphabet 
		*ngIf="courseIsSelected() && students().length"
		[ngClass]="{'disappear': screenType() === ScreenTypeEnum.DESKTOP && studentIsSelected()}"
		>
	</app-alphabet>

	<ng-container *ngTemplateOutlet="courseIsSelected() ? dataContainer : courseNotSelected"></ng-container>
	
	<ng-template #dataContainer>
		<div
		id="students-cards-container"
		*ngIf="students().length; else spinner"
		[ngClass]="{
			'disappear': (screenType() === ScreenTypeEnum.MOBILE && (!letterSelected() && !studentIsSelected()))
		}">
			<ng-container *ngFor="let student of students(); trackBy: trackItems">
				<mat-card 
					class="qualifications-students-card"
					*ngIf="(screenType() === ScreenTypeEnum.DESKTOP && student.show) || 
					(screenType() === ScreenTypeEnum.MOBILE && student.showForMobile)"
					id="{{ student.lastname.charAt(0).toUpperCase()}}"
				>
						<mat-card-header
							><h2 class="student-header">
								{{ student.name }} {{ student.lastname }}
							</h2></mat-card-header
						>
						<mat-card-content>
							<mat-tab-group
								#tabChildren
								animationDuration="0"
								[selectedIndex]="selectedTab()"
								(selectedIndexChange)="selectWorkType($event)"
								id="qualifications-tab-group">
								<mat-tab label="Tareas">
									<div
										class="cards-wrapper"
										*ngIf="
											taskMatchSomeFilter();
											else noMatchedTasks
										">
										<ng-container *ngFor="let task of tasks(); trackBy: trackItems">
											<app-work-card [work]="task" [student]="student" 
												*ngIf="task?.show"
											>
											</app-work-card>
										</ng-container>
									</div>
									<ng-template #noMatchedTasks>
										<app-warning [info]="'No se encontraron tareas'" [cardStyle]="{'height': '44rem'}" [imgSource]="'./assets/images/empty-icon.png'" [imgWidth]="150" [imgHeight]="150"></app-warning>
									</ng-template>
								</mat-tab>

								<mat-tab label="Exámenes">
									<div
										class="cards-wrapper"
										*ngIf="
											examMatchSomeFilter();
											else noMatchedExams
										">
										<ng-container *ngFor="let exam of exams(); trackBy: trackItems">
											<app-work-card [work]="exam" [student]="student" [workType]="WorkEnum.EXAM"
												*ngIf="exam?.show"
											>
											</app-work-card>
										</ng-container>
									</div>
									<ng-template #noMatchedExams>
										<app-warning [info]="'No se encontraron exámenes'" [cardStyle]="{'height': '44rem'}" [imgSource]="'./assets/images/empty-icon.png'" [imgWidth]="150" [imgHeight]="150"></app-warning>
									</ng-template>
								</mat-tab>
							</mat-tab-group>
						</mat-card-content>
				</mat-card>
			</ng-container>
		</div>

		<ng-template #spinner>
			<div class="spinner-wrapper">
				<mat-spinner></mat-spinner>
			</div>
		</ng-template>
	</ng-template>

	<ng-template #courseNotSelected>
		<div class="warning-container">
			<app-warning [info]="'Por favor, seleccione un curso'"></app-warning>
		</div>
	</ng-template>

	<!-- AVISOS EXCLUSIVAMENTE PARA MOBILE -->
	<ng-container
			[ngTemplateOutlet]="
				letterSelected()? noMatch: chooseAStudent
	"></ng-container>

	<ng-template #chooseAStudent>
		<app-warning 
				*ngIf="screenType() === ScreenTypeEnum.MOBILE && courseIsSelected() && noStudentShowingForMobile() && students().length"
				[info]="'Por favor, elija un alumnx desde los filtros o desde el alfabeto'"
		></app-warning>
	</ng-template>

	<ng-template #noMatch>
		<app-warning 
				*ngIf="screenType() === ScreenTypeEnum.MOBILE && noStudentShowingForMobile()"
				[info]="'No se encontraron alumnxs'"
		></app-warning>
	</ng-template>
	

	<app-scroll *ngIf="showScroll$ | async" (scrollToTop)="onScrollToTop()"></app-scroll>

	<app-menu-button *ngIf="students().length" title="Crear una nueva tarea o exámen" icon="add">
		<button mat-menu-item (click)="openCreateDialog()">
			<div class="menu-option-wrapper">
				<mat-icon aria-hidden="false" aria-label="Agregar nueva tarea / examen" fontIcon="note_add"></mat-icon>
				<span>Crear una tarea / examen</span>
			</div>
		</button>
		<button mat-menu-item (click)="openMultipleMarkingSetterDialog()">
			<div class="menu-option-wrapper">
				<mat-icon aria-hidden="false" aria-label="Asignar múltiples calificaciones" fontIcon="grading"></mat-icon>
				<span>Asignar múltiples calificaciones</span>
			</div>
		</button>
	</app-menu-button>
</div>

